{% extends "base.html" %}
{% block title %}Home{% endblock %}
{% block content %}
<body>
    <div class="container">
        <div class="table-container">
            <h1>Products</h1>
            <div class="search-bar">
                <input type="text" id="product-search" placeholder="Search Products">
                <button class="btn btn-primary" onclick="location.href='{{ url_for('add_product') }}'"><i class="fas fa-plus"></i></button>
            </div>
            <table id="product-table" class="table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Name</th>
                        <th>Category</th>
                        <th>Quantity</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody>
                    {% for product in products %}
                        <tr>
                            <td data-label="ID">{{ product.id }}</td>
                            <td data-label="Name">{{ product.name }}</td>
                            <td data-label="Category">{{ product.category_label }}</td>
                            <td data-label="Quantity">{{ product.quantity_available }}</td>
                            <td>
                                <a href="{{ url_for('edit_product', product_id=product.id) }}" class="btn btn-primary btn-sm">
                                    <i class="fas fa-edit"></i>
                                </a>
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        <div class="table-container">
            <h1>Partners</h1>
            <div class="search-bar">
                <input type="text" id="partner-search" placeholder="Search Partners">
                <button class="btn btn-primary" onclick="location.href='{{ url_for('add_partner') }}'"><i class="fas fa-plus"></i></button>
            </div>
            <table id="partner-table" class="table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Name</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody>
                    {% for partner in partners %}
                        <tr>
                            <td data-label="ID">{{ partner.id }}</td>
                            <td data-label="Name">{{ partner.name }}</td>
                            <td>
                                <a href="{{ url_for('edit_partner', partner_id=partner.id) }}" class="btn btn-primary btn-sm">
                                    <i class="fas fa-edit"></i>
                                </a>
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <div class="table-container">
            <h1>Warehouses</h1>
            <div class="search-bar">
                <input type="text" id="warehouse-search" placeholder="Search Warehouses">
                <button class="btn btn-primary" onclick="location.href='{{ url_for('add_warehouse') }}'"><i class="fas fa-plus"></i></button>
            </div>
            <table id="warehouse-table" class="table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Name</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody>
                    {% for warehouse in warehouses %}
                        <tr>
                            <td data-label="ID">{{ warehouse.id }}</td>
                            <td data-label="Name">{{ warehouse.name }}</td>
                            <td>
                                <a href="{{ url_for('edit_warehouse', warehouse_id=warehouse.id) }}" class="btn btn-primary btn-sm">
                                    <i class="fas fa-edit"></i>
                                </a>
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</body>

    <script>
        $(document).ready(function() {
            function search(endpoint, inputId, tableId) {
                $(inputId).on('input', function() {
                    var query = $(this).val();
                    $.ajax({
                        url: endpoint,
                        method: "GET",
                        data: { query: query },
                        success: function(data) {
                            var tableBody = $(tableId).find('tbody');
                            tableBody.empty();
                            data.forEach(function(item) {
                                var row = '<tr>';
                                row += '<td data-label="ID">' + item.id + '</td>';
                                row += '<td data-label="Name">' + item.name + '</td>';
                                if (tableId === "#product-table") {
                                    row += '<td data-label="Category">' + item.category_label + '</td>';
                                    row += '<td data-label="Quantity">' + item.quantity_available + '</td>';
                                }

                                row += '<td>';
                                if (tableId === "#product-table") {
                                    row += '<a href="/product/' + item.id + '/edit" class="btn btn-primary btn-sm">';
                                }
                                else if (tableId === "#partner-table") {
                                    row += '<a href="/partner/' + item.id + '/edit" class="btn btn-primary btn-sm">';
                                }
                                else if (tableId === "#warehouse-table") {
                                    row += '<a href="/warehouse/' + item.id + '/edit" class="btn btn-primary btn-sm">';
                                }
                                row += '<i class="fas fa-edit"></i>';
                                row += '</td>';
                                row += '</tr>';
                                tableBody.append(row);
                            });
                        },
                        error: function(xhr, status, error) {
                            console.error("AJAX Error:", status, error);
                        }
                    });
                });
            }

            search("{{ url_for('get_partners') }}", "#partner-search", "#partner-table");
            search("{{ url_for('get_warehouses') }}", "#warehouse-search", "#warehouse-table");
            search("{{ url_for('get_products') }}", "#product-search", "#product-table");
        });
    </script>
{% endblock %}