{% extends "base.html" %}
{% block title %}Home{% endblock %}
{% block content %}
<body>
    <div class="container">
        <div class="table-row">
            <div class="table-column">
                <h1>Partners</h1>
                <div class="search-bar">
                    <input type="text" id="partner-search" placeholder="Search Partners">
                    <button class="btn btn-primary" onclick="location.href='{{ url_for('add_partner') }}'"><i class="fas fa-plus"></i></button>
                </div>
                <table id="partner-table" class="table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Name</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for partner in partners %}
                            <tr>
                                <td>{{ partner.id }}</td>
                                <td>{{ partner.name }}</td>
                                <td>
                                    <a href="{{ url_for('edit_partner', partner_id=partner.id) }}" class="btn btn-primary btn-sm">
                                        <i class="fas fa-edit"></i>
                                    </a>
                                </td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>

            <div class="table-column">
                <h1>Warehouses</h1>
                <div class="search-bar">
                    <input type="text" id="warehouse-search" placeholder="Search Warehouses">
                    <button class="btn btn-primary" onclick="location.href='{{ url_for('add_warehouse') }}'"><i class="fas fa-plus"></i></button>
                </div>
                <table id="warehouse-table" class="table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Name</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for warehouse in warehouses %}
                            <tr>
                                <td>{{ warehouse.id }}</td>
                                <td>{{ warehouse.name }}</td>
                                <td>
                                    <a href="{{ url_for('edit_warehouse', warehouse_id=warehouse.id) }}" class="btn btn-primary btn-sm">
                                        <i class="fas fa-edit"></i>
                                    </a>
                                </td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>

            <div class="table-column">
                <h1>Products</h1>
                <div class="search-bar">
                    <input type="text" id="product-search" placeholder="Search Products">
                    <button class="btn btn-primary" onclick="location.href='{{ url_for('add_product') }}'"><i class="fas fa-plus"></i></button>
                </div>
                <table id="product-table" class="table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Name</th>
                            <th>Category</th>
                            <th>Quantity</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for product in products %}
                            <tr>
                                <td>{{ product.id }}</td>
                                <td>{{ product.name }}</td>
                                <td>{{ product.category_label }}</td>
                                <td>{{ product.quantity_available }}</td>
                                <td>
                                    <a href="{{ url_for('edit_product', product_id=product.id) }}" class="btn btn-primary btn-sm">
                                        <i class="fas fa-edit"></i>
                                    </a>
                                </td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        $(document).ready(function() {
            function search(endpoint, inputId, tableId) {
                $(inputId).on('input', function() {
                    var query = $(this).val();
                    $.ajax({
                        url: endpoint,
                        method: "GET",
                        data: { query: query },
                        success: function(data) {
                            var tableBody = $(tableId).find('tbody');
                            tableBody.empty();
                            data.forEach(function(item) {
                                var row = '<tr>';
                                row += '<td>' + item.id + '</td>';
                                row += '<td>' + item.name + '</td>';
                                if (tableId === "#product-table") {
                                    row += '<td>' + item.category_label + '</td>';
                                    row += '<td>' + item.quantity_available + '</td>';
                                }
                                row += '</tr>';
                                tableBody.append(row);
                            });
                        },
                        error: function(xhr, status, error) {
                            console.error("AJAX Error:", status, error);
                        }
                    });
                });
            }

            search("{{ url_for('search_partners') }}", "#partner-search", "#partner-table");
            search("{{ url_for('search_warehouses') }}", "#warehouse-search", "#warehouse-table");
            search("{{ url_for('search_products') }}", "#product-search", "#product-table");
        });
    </script>
</body>
{% endblock %}
